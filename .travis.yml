{
  "language": "ruby",
  "os": [
    "linux"
  ],
  "dist": "xenial",
  "cache": {
    "directories": [
      "$HOME/.pub-cache"
    ]
  },
  "jobs": {
    "fast_finish": true,
    "allow_failures": [
      {
        "env": [
          {
            "JOB": "APK"
          }
        ]
      },
      {
        "env": [
          {
            "JOB": "IPA"
          }
        ]
      }
    ],
    "include": [
      {
        "env": [
          {
            "JOB": "PR/TEST"
          }
        ],
        "os": "linux",
        "language": "generic",
        "sudo": true,
        "addons": {
          "apt": {
            "sources": [
              {
                "name": "ubuntu-toolchain-r-test"
              }
            ],
            "packages": [
              "libstdc++6",
              "fonts-droid"
            ]
          }
        },
        "before_script": [
          "git clone https://github.com/flutter/flutter.git"
        ],
        "script": [
          "yes | ./flutter/bin/flutter doctor --android-licenses",
          "./flutter/bin/flutter test test/widget_test.dart"
        ]
      },
      {
        "licenses": [
          "yes | 'android-sdk-preview-license-.+'",
          "yes | 'android-sdk-license-.+'",
          "yes | 'google-gdk-license-.+'"
        ],
        "env": [
          {
            "JOB": "APK"
          }
        ],
        "os": "linux",
        "language": "android",
        "android": {
          "components": [
            "tools",
            "platform-tools",
            "build-tools-28.0.3",
            "build-tools-27",
            "android-28",
            "android-27",
            "sys-img-armeabi-v7a-google_apis-25",
            "extra-android-m2repository",
            "extra-google-m2repository",
            "extra-google-android-support"
          ]
        },
        "jdk": "oraclejdk8",
        "sudo": true,
        "addons": {
          "apt": {
            "sources": [
              {
                "name": "ubuntu-toolchain-r-test"
              }
            ],
            "packages": [
              "libstdc++6",
              "fonts-droid"
            ]
          }
        },
        "before_script": [
          "wget http://services.gradle.org/distributions/gradle-4.10.2-all.zip",
          "unzip -qq gradle-4.10.2-all",
          "export GRADLE_HOME=$PWD/gradle-4.10.2-all",
          "export PATH=$GRADLE_HOME/bin:$PATH",
          "git clone https://github.com/flutter/flutter.git"
        ],
        "script": [
          "./flutter/bin/flutter build apk --release"
        ]
      },
      {
        "env": [
          {
            "JOB": "IPA"
          }
        ],
        "os": "osx",
        "language": "generic",
        "osx_image": "xcode10.1",
        "before_script": [
          "pip install six",
          "brew update",
          "brew install --HEAD usbmuxd",
          "brew install --HEAD libimobiledevice",
          "brew install ideviceinstaller",
          "brew install ios-deploy",
          "git clone https://github.com/flutter/flutter.git"
        ],
        "script": [
          "./flutter/bin/flutter -v build ios --no-codesign"
        ]
      }
    ]
  }
}